<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaGuard Kenya: IoT Water Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        
        async function fetchGeminiResponse(systemPrompt, userQuery) {
            const loader = document.getElementById('market-loader') || document.getElementById('safety-loader');
            if(loader) loader.classList.remove('hidden');

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            const maxRetries = 3;
            let delay = 1000;
            
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429 && i < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; 
                        continue;
                    }

                    const result = await response.json();
                    
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Error: Failed to get response from Gemini.";
                    if(loader) loader.classList.add('hidden');
                    return text;
                } catch (error) {
                    if (i < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; 
                    } else {
                        if(loader) loader.classList.add('hidden');
                        return "Error: Network or API failure.";
                    }
                }
            }
        }
        
        async function analyzeMarketViability() {
            const output = document.getElementById('market-analysis-output');
            
            output.innerHTML = 'Analyzing KES costs and Nairobi market data...';

            const systemPrompt = "You are a professional financial analyst. Based on the provided data, provide a concise, two-paragraph analysis of the project's profitability, risk, and market viability. Highlight the profit margin and the target market size (40% of Nairobi homes).";
            
            const userQuery = `Project: AquaGuard Kenya Water Management System. Components Cost (BOM): KES 6,880. Low-end Selling Price: KES 18,000. High-end Selling Price: KES 25,000. Target Market: 40% of Nairobi homes use tank systems.`;

            const analysis = await fetchGeminiResponse(systemPrompt, userQuery);

            output.innerHTML = `<div class="p-4 bg-gray-50 rounded-lg text-sm whitespace-pre-wrap">${analysis}</div>`;
        }
        
        async function checkSafetyCertifications() {
            const output = document.getElementById('safety-output');
            
            output.innerHTML = 'Generating compliance report based on SSR and AC voltage...';

            const systemPrompt = "You are an expert electrical safety and compliance engineer. Given the hardware components, generate a short, critical safety checklist for the manufacturer. Include 3 essential safety tips and recommend the necessary international certification (CE, FCC, or UL) required for a consumer product operating on 240V AC mains in a new market. Use clear bullet points.";
            
            const userQuery = `Core components handling mains power: Solid State Relay (SSR-40DA) and 240V AC Pump. Operating environment: High humidity (tanks). Goal: Consumer safety and market approval.`;

            const checklist = await fetchGeminiResponse(systemPrompt, userQuery);

            output.innerHTML = `<div class="p-4 bg-red-50 rounded-lg border border-red-300 text-sm whitespace-pre-wrap">${checklist}</div>`;
        }
    </script>
    <!-- 
        Chosen Palette: Savanna Calm 
        Application Structure Plan: The SPA is structured as a narrative journey, starting with a high-level overview and impact (the "Why"), moving to an interactive system diagram (the "How it Works"), delving into specific technical pillars (the "What"), analyzing the business case (the "Why it's Viable"), and concluding with the production roadmap (the "What's Next"). This thematic, top-down structure is more intuitive for a broader audience than a traditional report layout. It allows a user to grasp the core value proposition immediately, explore the system's architecture interactively, and then drill down into technical or economic details as needed via tabs and dedicated sections. This flow prioritizes user understanding and engagement over strict adherence to the source document's order.
        Visualization & Content Choices: 
        - Report Info: Key project benefits (water/cost savings, pump protection). Goal: Inform/Impact. Viz/Method: Prominent stat cards (HTML/CSS). Interaction: Static. Justification: Immediately communicates the core value proposition.
        - Report Info: Overall system architecture. Goal: Organize/Explain. Viz/Method: Interactive diagram using HTML/Tailwind divs. Interaction: Hover/click on components to display detailed info text via JS. Justification: More engaging and explorable than a static image, allowing users to learn at their own pace.
        - Report Info: Technical details (Hardware, Software, Safety). Goal: Organize/Inform. Viz/Method: Tabbed content sections (HTML/JS). Interaction: Click tabs to switch content. Justification: Organizes dense technical information into digestible chunks, preventing user overload.
        - Report Info: Bill of Materials (BOM) cost breakdown. Goal: Compare/Analyze. Viz/Method: Donut Chart (Chart.js). Interaction: Tooltips on hover. Justification: Effectively shows the proportional cost of each component category.
        - Report Info: Cost vs. Price vs. Profit. Goal: Compare/Analyze. Viz/Method: Bar Chart (Chart.js). Interaction: Tooltips on hover. Justification: Clearly visualizes the project's economic viability and profit margin.
        - Report Info: Manufacturing Process. Goal: Explain Change. Viz/Method: Numbered list/timeline (HTML/CSS). Interaction: Static. Justification: A simple, clear process flow is most effective for this linear information.
        - New Feature (AI): Market Viability Analysis. Goal: Analyze/Synthesize. Viz/Method: Text output block. Interaction: Click button (on demand). Justification: Provides a high-value, instant expert perspective on profitability and market fit, improving stakeholder confidence.
        - New Feature (AI): Safety Checklist. Goal: Inform/Compliance. Viz/Method: Text output block with alert styling. Interaction: Click button (on demand). Justification: Generates critical, context-aware regulatory advice based on high-voltage hardware.
        CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F5F5; 
            color: #4A4A4A;
        }
        .bg-primary { background-color: #F5F5F5; }
        .bg-secondary { background-color: #FFFFFF; }
        .bg-accent { background-color: #00796B; } 
        .text-accent { color: #00796B; }
        .border-accent { border-color: #00796B; }
        .nav-link {
            padding: 8px 16px;
            border-radius: 9999px;
            transition: all 0.3s;
            font-weight: 500;
        }
        .nav-link:hover, .nav-link.active {
            background-color: #E0F2F1; 
            color: #004D40;
        }
        .stat-card {
            background-color: #FFFFFF;
            border-left: 5px solid #00796B;
        }
        .system-component {
            transition: all 0.3s ease-in-out;
            cursor: pointer;
        }
        .system-component:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .tab-button {
            transition: all 0.3s;
        }
        .tab-button.active {
            border-color: #00796B;
            background-color: #E0F2F1;
            color: #004D40;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 40vh;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
    </style>
</head>
<body class="bg-primary">

    <!-- Header & Navigation -->
    <header class="bg-secondary/80 backdrop-blur-sm sticky top-0 z-50 shadow-md">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-accent">AquaGuard Kenya</h1>
            <div class="hidden md:flex space-x-2">
                <a href="#overview" class="nav-link">Overview</a>
                <a href="#architecture" class="nav-link">Architecture</a>
                <a href="#details" class="nav-link">The Solution</a>
                <a href="#economics" class="nav-link">Impact</a>
                <a href="#ai-analysis" class="nav-link">AI Insight</a>
                <a href="#production" class="nav-link">Roadmap</a>
            </div>
            <div class="md:hidden">
                <select id="mobile-nav" class="bg-gray-200 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-accent focus:border-accent block w-full p-2.5">
                    <option value="#overview">Overview</option>
                    <option value="#architecture">Architecture</option>
                    <option value="#details">The Solution</option>
                    <option value="#economics">Impact</option>
                    <option value="#ai-analysis">AI Insight</option>
                    <option value="#production">Roadmap</option>
                </select>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">

        <!-- Section 1: Overview / Hero -->
        <section id="overview" class="text-center mb-20">
            <h2 class="text-4xl font-bold mb-4">Smart Water Management for a Resilient Kenya</h2>
            <p class="max-w-3xl mx-auto text-lg text-gray-600 mb-10">
                AquaGuard is an IoT-driven system that fully automates dual-tank water management, providing real-time remote monitoring and crucial dry-run protection to save water, energy, and money. It's designed specifically for the challenges of urban Kenyan homes and businesses.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto">
                <div class="stat-card p-6 rounded-lg shadow-lg text-left">
                    <span class="text-4xl">üíß</span>
                    <h3 class="text-xl font-semibold mt-2">Prevent Water Wastage</h3>
                    <p class="text-gray-600 mt-1">Intelligent automation stops tank overflows, saving thousands of liters per month and conserving a vital resource during shortages.</p>
                </div>
                <div class="stat-card p-6 rounded-lg shadow-lg text-left">
                    <span class="text-4xl">üí∞</span>
                    <h3 class="text-xl font-semibold mt-2">Save Money</h3>
                    <p class="text-gray-600 mt-1">Prevents catastrophic pump burnout from dry-running, saving homeowners over **KES 15,000** in potential repair and replacement costs.</p>
                </div>
                <div class="stat-card p-6 rounded-lg shadow-lg text-left">
                    <span class="text-4xl">üõ°Ô∏è</span>
                    <h3 class="text-xl font-semibold mt-2">Ensure Reliability</h3>
                    <p class="text-gray-600 mt-1">Hybrid power with battery backup guarantees the system remains operational during frequent power cuts, ensuring continuous monitoring.</p>
                </div>
            </div>
        </section>

        <!-- Section 2: Interactive Architecture -->
        <section id="architecture" class="mb-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold">Interactive System Architecture</h2>
                <p class="text-gray-600 mt-2 max-w-2xl mx-auto">Hover over or click on each component to understand its role in the AquaGuard ecosystem. This diagram shows the complete data and command flow from your tanks to your fingertips.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-center">
                <div id="diagram-container" class="lg:col-span-2 grid grid-cols-3 grid-rows-3 gap-4 items-center text-center">
                    <!-- Row 1 -->
                    <div class="system-component bg-secondary p-4 rounded-lg shadow-md" data-info="device">
                        <h4 class="font-semibold">Device Layer</h4>
                        <p class="text-sm">ESP32 & Sensors</p>
                    </div>
                    <div class="flex items-center justify-center text-2xl font-mono text-accent">‚Üí</div>
                    <div class="system-component bg-secondary p-4 rounded-lg shadow-md" data-info="cloud">
                        <h4 class="font-semibold">Cloud Ingest</h4>
                        <p class="text-sm">AWS IoT Core (MQTTs)</p>
                    </div>
                    
                    <!-- Vertical Arrow -->
                    <div></div>
                    <div></div>
                    <div class="flex items-center justify-center text-2xl font-mono text-accent -rotate-90 scale-150 my-4">‚Üí</div>

                    <!-- Row 2 -->
                    <div class="system-component bg-secondary p-4 rounded-lg shadow-md" data-info="control">
                        <h4 class="font-semibold">Control Flow</h4>
                        <p class="text-sm">Web App ‚Üí ESP32</p>
                    </div>
                    <div class="flex items-center justify-center text-2xl font-mono text-accent scale-x-[-1]">‚Üí</div>
                     <div class="system-component bg-secondary p-4 rounded-lg shadow-md" data-info="backend">
                        <h4 class="font-semibold">Backend Logic</h4>
                        <p class="text-sm">Django & WebSockets</p>
                    </div>

                    <!-- Vertical Arrow -->
                    <div></div>
                    <div></div>
                    <div class="flex items-center justify-center text-2xl font-mono text-accent rotate-90 scale-150 my-4">‚Üí</div>

                    <!-- Row 3 -->
                    <div></div>
                    <div class="flex items-center justify-center text-2xl font-mono text-accent">‚Üí</div>
                    <div class="system-component bg-secondary p-4 rounded-lg shadow-md" data-info="frontend">
                        <h4 class="font-semibold">User Interface</h4>
                        <p class="text-sm">Web Dashboard</p>
                    </div>
                </div>

                <div id="diagram-info" class="bg-secondary p-6 rounded-lg shadow-lg min-h-[250px] flex flex-col justify-center">
                    <h3 class="font-bold text-lg text-accent mb-2">Component Details</h3>
                    <p class="text-gray-600">Select a component to learn more.</p>
                </div>
            </div>
        </section>

        <!-- Section 3: The Solution in Detail -->
        <section id="details" class="mb-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold">The Solution in Detail</h2>
                <p class="text-gray-600 mt-2 max-w-2xl mx-auto">Explore the core pillars of the AquaGuard system. From the robust hardware that interacts with the physical world to the secure, scalable software that brings control to your screen.</p>
            </div>
            
            <div class="flex justify-center mb-6 border-b-2">
                <button class="tab-button active py-2 px-6 font-semibold border-b-2 border-transparent" data-tab="hardware">Hardware & Electronics</button>
                <button class="tab-button py-2 px-6 font-semibold border-b-2 border-transparent" data-tab="software">Software & Cloud</button>
                <button class="tab-button py-2 px-6 font-semibold border-b-2 border-transparent" data-tab="safety">Safety & Reliability</button>
            </div>

            <div id="tab-content" class="bg-secondary p-8 rounded-lg shadow-lg">
                <div id="hardware-content" class="tab-pane active">
                    <h3 class="text-2xl font-bold text-accent mb-4">Hardware & Electronics</h3>
                    <p class="mb-4">The physical unit is built with proven, off-the-shelf components selected for reliability and cost-effectiveness. The core is the ESP32 microcontroller, which provides Wi-Fi connectivity and processing power. It interfaces with two key sensor types:</p>
                    <ul class="list-disc list-inside space-y-2">
                        <li><strong>JSN-SR04T Ultrasonic Sensor:</strong> A waterproof sensor that measures water levels with high precision by calculating the time-of-flight of a 40kHz sound pulse. This provides non-contact, reliable data even in humid tank environments.</li>
                        <li><strong>ACS712 Current Sensor:</strong> This sensor operates on the Hall Effect principle, generating a voltage proportional to the current flowing through the pump's live wire. This allows the ESP32 to non-invasively monitor the pump's power consumption and detect a dry-run condition.</li>
                    </ul>
                </div>
                <div id="software-content" class="tab-pane hidden">
                    <h3 class="text-2xl font-bold text-accent mb-4">Software & Cloud Architecture</h3>
                    <p class="mb-4">The software stack is designed for security, scalability, and flexibility, allowing deployment on platforms like Render or AWS.</p>
                    <ul class="list-disc list-inside space-y-2">
                        <li><strong>Cloud Communication (AWS IoT Core):</strong> The ESP32 communicates with the cloud using the secure and lightweight MQTTs protocol. AWS IoT Core acts as the central message broker, reliably routing data from thousands of devices.</li>
                        <li><strong>Web Application (Django):</strong> The user-facing dashboard is a powerful Django application. It uses Django Channels and the Daphne server to handle real-time WebSocket connections, pushing live data to the user's browser without needing to refresh the page.</li>
                         <li><strong>Hosting Strategy:</strong> The Django app is architected for portability. It can be quickly deployed to **Render** for its simplicity and managed PostgreSQL, and later migrated to **AWS Elastic Beanstalk** for fine-grained control and deeper integration with other AWS services as the user base scales.</li>
                        <li><strong>Database Strategy:</strong> A dual-database approach ensures performance. **PostgreSQL (AWS RDS)** stores structured user and device ownership data, while **DynamoDB** is used for high-volume, time-series sensor data, perfect for future analytics.</li>
                    </ul>
                </div>
                <div id="safety-content" class="tab-pane hidden">
                    <h3 class="text-2xl font-bold text-accent mb-4">Safety & Reliability Features</h3>
                    <p class="mb-4">AquaGuard is engineered to be resilient against common failure points in the Kenyan context.</p>
                    <ul class="list-disc list-inside space-y-2">
                        <li><strong>Intelligent Dry-Run Protection:</strong> The system's firmware includes a debouncing algorithm. It requires 5 consecutive low-current readings from the ACS712 sensor (over 2.5 seconds) to confirm a dry-run event. This prevents false alarms from momentary power fluctuations and ensures the pump is shut down only when genuinely at risk.</li>
                        <li><strong>Hybrid Power System:</strong> During a power outage, the TP4056 module seamlessly switches power to the 18650 lithium-ion battery. The MT3608 boost converter ensures the ESP32 receives a stable 5V, keeping the system's brain online, monitoring levels, and ready to resume automatic operation the moment mains power is restored.</li>
                        <li><strong>Hysteresis Control:</strong> The pump logic prevents rapid on/off cycling (chattering) which can damage the pump motor. It waits for the water level to drop to a significant low point (e.g., 30%) before starting and fills it to a high point (e.g., 95%) before stopping, ensuring longer, more efficient pumping cycles.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Section 4: Economic Impact -->
        <section id="economics" class="mb-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold">Economic & Market Impact</h2>
                <p class="text-gray-600 mt-2 max-w-2xl mx-auto">AquaGuard is not only a technical solution but a commercially viable product tailored for the Kenyan market, offering significant savings to users and a strong business case.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="bg-secondary p-6 rounded-lg shadow-lg">
                    <h3 class="text-xl font-semibold text-center mb-4">Component Cost Breakdown (BOM)</h3>
                    <div class="chart-container">
                        <canvas id="bomChart"></canvas>
                    </div>
                </div>
                <div class="bg-secondary p-6 rounded-lg shadow-lg">
                    <h3 class="text-xl font-semibold text-center mb-4">Profitability Analysis</h3>
                     <div class="chart-container">
                        <canvas id="profitChart"></canvas>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Section 5: AI Insight -->
        <section id="ai-analysis" class="mb-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-accent">‚ú® AI Expert Analysis</h2>
                <p class="text-gray-600 mt-2 max-w-2xl mx-auto">Utilize Gemini to instantly analyze the project's economic risks and generate a critical safety compliance checklist based on the high-voltage components.</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Market Viability Analysis -->
                <div class="bg-secondary p-6 rounded-lg shadow-lg">
                    <h3 class="text-xl font-semibold mb-4">Market & Financial Viability</h3>
                    <button onclick="analyzeMarketViability()" class="bg-accent text-white px-4 py-2 rounded-lg text-sm hover:bg-teal-700 transition duration-150">
                        ‚ú® Run Financial Analysis
                    </button>
                    <div id="market-loader" class="hidden text-center mt-4">
                        <p class="text-sm text-gray-500">Analyzing KES costs and Nairobi market data...</p>
                    </div>
                    <div id="market-analysis-output" class="mt-4">
                        <p class="text-gray-500 text-sm">Click "Run Financial Analysis" to see an expert summary.</p>
                    </div>
                </div>
                
                <!-- Safety and Certification Checklist -->
                <div class="bg-secondary p-6 rounded-lg shadow-lg">
                    <h3 class="text-xl font-semibold mb-4">Safety & Compliance Checklist (240V AC)</h3>
                    <button onclick="checkSafetyCertifications()" class="bg-red-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-red-700 transition duration-150">
                        ‚ú® Generate Safety Checklist
                    </button>
                    <div id="safety-loader" class="hidden text-center mt-4">
                        <p class="text-sm text-gray-500">Generating compliance report based on SSR and AC voltage...</p>
                    </div>
                    <div id="safety-output" class="mt-4">
                        <p class="text-gray-500 text-sm">Click "Generate Safety Checklist" for vital compliance recommendations.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 6: Production Roadmap -->
        <section id="production" class="bg-secondary p-8 rounded-lg shadow-lg">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold">Production & Future Roadmap</h2>
                <p class="text-gray-600 mt-2 max-w-2xl mx-auto">From a validated prototype to a market-ready product, this is our plan for scaling manufacturing and enhancing the AquaGuard system.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                <div>
                    <h3 class="text-xl font-bold text-accent mb-4">Manufacturing Process</h3>
                    <ol class="relative border-l border-gray-300 space-y-6">
                        <li class="ml-6">
                            <span class="absolute flex items-center justify-center w-6 h-6 bg-teal-100 rounded-full -left-3 ring-8 ring-white">1</span>
                            <h4 class="font-semibold">PCB Assembly</h4>
                            <p class="text-sm text-gray-600">Automated PCBA for SMD components, with manual soldering for through-hole parts.</p>
                        </li>
                        <li class="ml-6">
                            <span class="absolute flex items-center justify-center w-6 h-6 bg-teal-100 rounded-full -left-3 ring-8 ring-white">2</span>
                            <h4 class="font-semibold">Firmware & Provisioning</h4>
                            <p class="text-sm text-gray-600">Flash firmware and securely provision each unit with unique AWS IoT certificates.</p>
                        </li>
                        <li class="ml-6">
                            <span class="absolute flex items-center justify-center w-6 h-6 bg-teal-100 rounded-full -left-3 ring-8 ring-white">3</span>
                            <h4 class="font-semibold">Quality Control</h4>
                            <p class="text-sm text-gray-600">Rigorous bench testing of all electronic functions, including simulated dry-run events.</p>
                        </li>
                         <li class="ml-6">
                            <span class="absolute flex items-center justify-center w-6 h-6 bg-teal-100 rounded-full -left-3 ring-8 ring-white">4</span>
                            <h4 class="font-semibold">Final Assembly</h4>
                            <p class="text-sm text-gray-600">Secure board in IP65-rated enclosure and apply waterproofing seals.</p>
                        </li>
                    </ol>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-accent mb-4">Deployment Roadmap</h3>
                    <div class="space-y-4">
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-semibold">Phase 1: Quick Hosting (Render)</h4>
                            <p class="text-sm text-gray-600">Initial deployment on **Render** (or similar managed service) for speed, simplified database integration, and automatic HTTPS/SSL certificate management.</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-semibold">Phase 2: Scale & Cost Optimization (AWS)</h4>
                            <p class="text-sm text-gray-600">Migrate to **AWS Elastic Beanstalk** (for Django/ASGI) and **AWS S3** (for static files) for deeper cost control, performance tuning, and scalability once user volume increases.</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-semibold">Future: OTA & Advanced Monitoring</h4>
                            <p class="text-sm text-gray-600">Implement Over-the-Air updates and advanced alerting (SMS/Email) using the scalable cloud infrastructure.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-secondary mt-20 py-6">
        <div class="container mx-auto text-center text-gray-500">
            <p>&copy; 2025 AquaGuard Kenya. A Production-Ready IoT Solution.</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const bomData = {
        labels: ['Sensors (JSN-SR04T)', 'Relay (SSR)', 'ESP32', 'LCD', 'Power System', 'Current Sensor', 'Other'],
        data: [1600, 1100, 1000, 1200, 650, 400, 930]
    };

    const profitData = {
        labels: ['Low-End', 'High-End'],
        costs: [6880, 6880],
        prices: [18000, 25000],
        profits: [11120, 18120]
    };

    const diagramInfo = {
        device: {
            title: 'Device Layer: The Senses',
            text: 'The ESP32 microcontroller acts as the on-site brain. It reads data from the JSN-SR04T ultrasonic sensors (water level) and the ACS712 current sensor (pump status) in real-time.'
        },
        cloud: {
            title: 'Cloud Ingest: The Superhighway',
            text: 'Data from the ESP32 is securely published to AWS IoT Core using the MQTTs protocol. This serves as a highly scalable and reliable message broker, capable of handling data from thousands of devices simultaneously.'
        },
        backend: {
            title: 'Backend Logic: The Central Brain',
            text: 'A Django application, running on a cloud server (like Render or AWS), subscribes to the MQTT topics. It processes incoming data, stores it, and manages the logic for real-time updates and commands.'
        },
        frontend: {
            title: 'User Interface: Your Control Panel',
            text: 'The custom Django web application renders an interactive dashboard in your browser. It uses WebSockets to receive live data from the backend, providing an instant view of your water system without needing to refresh the page.'
        },
        control: {
            title: 'Control Flow: Sending Commands',
            text: 'When you press a button on the web app, a command (e.g., PUMP_ON) is sent via WebSocket to the Django server. The server then publishes this command to a specific MQTT topic on AWS IoT Core, which the target ESP32 is subscribed to, allowing for remote control.'
        },
        default: {
            title: 'Component Details',
            text: 'Select a component to learn more about its function within the AquaGuard system.'
        }
    };
    
    function initBOMChart() {
        const ctx = document.getElementById('bomChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: bomData.labels,
                datasets: [{
                    label: 'Cost (Ksh)',
                    data: bomData.data,
                    backgroundColor: ['#004D40', '#00796B', '#4DB6AC', '#B2DFDB', '#80CBC4', '#26A69A', '#E0F2F1'],
                    borderColor: '#FFFFFF',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                             boxWidth: 15
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed !== null) {
                                    label += new Intl.NumberFormat('en-KE', { style: 'currency', currency: 'KSH' }).format(context.parsed);
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }

    function initProfitChart() {
        const ctx = document.getElementById('profitChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: profitData.labels,
                datasets: [
                    {
                        label: 'BOM Cost',
                        data: profitData.costs,
                        backgroundColor: '#FFAB91',
                    },
                    {
                        label: 'Selling Price',
                        data: profitData.prices,
                        backgroundColor: '#4DB6AC',
                    },
                    {
                        label: 'Profit',
                        data: profitData.profits,
                        backgroundColor: '#00796B',
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'Ksh ' + (value / 1000) + 'k';
                            }
                        }
                    }
                },
                plugins: {
                     legend: {
                        position: 'bottom',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                     label += new Intl.NumberFormat('en-KE', { style: 'currency', currency: 'KSH' }).format(context.parsed.y);
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }

    function handleTabs() {
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabPanes = document.querySelectorAll('.tab-pane');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.dataset.tab;

                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                tabPanes.forEach(pane => {
                    if (pane.id === `${tabId}-content`) {
                        pane.classList.remove('hidden');
                    } else {
                        pane.classList.add('hidden');
                    }
                });
            });
        });
    }

    function handleDiagramInteraction() {
        const components = document.querySelectorAll('.system-component');
        const infoBox = document.getElementById('diagram-info');
        
        const updateInfoBox = (key) => {
            const info = diagramInfo[key] || diagramInfo.default;
            infoBox.innerHTML = `
                <h3 class="font-bold text-lg text-accent mb-2">${info.title}</h3>
                <p class="text-gray-600">${info.text}</p>
            `;
        };

        components.forEach(component => {
            const infoKey = component.dataset.info;
            component.addEventListener('mouseenter', () => updateInfoBox(infoKey));
            component.addEventListener('click', () => updateInfoBox(infoKey));
        });
        
        document.getElementById('diagram-container').addEventListener('mouseleave', () => updateInfoBox('default'));
    }

    function handleMobileNav() {
        const mobileNav = document.getElementById('mobile-nav');
        mobileNav.addEventListener('change', (e) => {
            const targetId = e.target.value;
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth' });
            }
        });
    }
    
    function handleScrollSpy() {
        const sections = document.querySelectorAll('section');
        const navLinks = document.querySelectorAll('.nav-link');

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute('id');
                    navLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === `#${id}`) {
                            link.classList.add('active');
                        }
                    });
                }
            });
        }, { rootMargin: "-50% 0px -50% 0px" });

        sections.forEach(section => {
            observer.observe(section);
        });
    }

    initBOMChart();
    initProfitChart();
    handleTabs();
    handleDiagramInteraction();
    handleMobileNav();
    handleScrollSpy();
});
</script>
</body>
</html>
